syntax = "proto3";

package protobuf;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/EvgeniyBudaev/tgdating-go/app/proto";

message FileMetadata {
  string filename = 1; // Имя файла
  int64 size = 2; // Размер файла в байтах
  bytes content = 3;   // Содержимое файла в виде массива байтов
}

message Image {
  uint64 id = 1; // id изображения
  string sessionId = 2; // id сессии
  string name = 3; // название файла
  string url = 4; // url файла
  int64 size = 5; // Размер файла в байтах
  bool isDeleted = 6; // удалено изображение да/нет
  bool isBlocked = 7; // заблокировано изображение да/нет
  bool isPrimary = 8; // изображение является основным да/нет
  bool isPrivate = 9; // изображение является приватным да/нет
  google.protobuf.Timestamp createdAt = 15; // дата создания
  google.protobuf.Timestamp updatedAt = 16; // дата обновления
}

message Point {
  double latitude = 1; // широта
  double longitude = 2; // долгота
}

message NavigatorResponse {
  string sessionId = 1; // id сессии
  Point location = 2; // объект с координатами
}
message NavigatorDetailResponse {
  uint64 distance = 1; // расстояние до просматриваемого пользователя
}

message FilterResponse {
  string sessionId = 1; // id сессии
  string searchGender = 2; // поиск по половому признаку
  string lookingFor = 3; // цель поиска
  uint64 ageFrom = 4; // возраст от
  uint64 ageTo = 5; // возраст до
  double distance = 6; // дистанция
  uint64 page = 7; // номер текущей страницы
  uint64 size = 8; // количество элементов на странице
}

message TelegramResponse {
  string sessionId = 1; // id сессии
  uint64 userId = 2; // id пользователя
  string username = 3; // username пользователя
  string firstName = 4; // имя пользователя
  string lastName = 5; // фамилия пользователя
  string languageCode = 6; // язык пользователя
  bool allowsWriteToPm = 7; // true, если этот пользователь разрешил боту отправлять ему сообщения
  string queryId = 8; // id чата
}

message BlockResponse {
  bool isBlocked = 1; // заблокирован пользователь да/нет
}

message LikeResponse {
  uint64 id = 1; // id лайка
  string sessionId = 2; // id сессии
  string likedSessionId = 3; // id сессии того, кого лайкнули
  bool isLiked = 4; // установлен лайк да/нет
  google.protobuf.Timestamp createdAt = 5; // дата создания
  google.protobuf.Timestamp updatedAt = 6; // дата обновления
}

message ProfileAddRequest {
  string sessionId = 1; // id сессии
  string displayName = 2; // Имя для отображения
  google.protobuf.Timestamp birthday = 3; // дата для рождения
  string gender = 4; // пол
  string searchGender = 5; // поиск по половому признаку
  string location = 6; // местоположение
  string description = 7; // описание
  double height = 8; // рост
  double weight = 9; // вес
  string lookingFor = 10; // цель поиска
  uint64 telegramUserId = 11; // id пользователя в телеграм
  string telegramUsername = 12; // username пользователя в телеграм
  string telegramFirstName = 13; // имя пользователя в телеграм
  string telegramLastName = 14; // фамилия пользователя в телеграм
  string telegramLanguageCode = 15; // язык пользователя в телеграм
  bool telegramAllowsWriteToPm = 16; // true, если этот пользователь разрешил боту отправлять ему сообщения
  string telegramQueryId = 17; // id чата в телеграм
  optional double latitude = 18; // широта
  optional double longitude = 19; // долгота
  uint64 ageFrom = 20; // возраст от
  uint64 ageTo = 21; // возраст до
  double distance = 22; // дистанция
  uint64 page = 23; // номер текущей страницы
  uint64 size = 24; // количество элементов на странице
  repeated FileMetadata files = 25; // список файлов-изображений
}

message ProfileAddResponse {
  string sessionId = 1; // id сессии
}

message ProfileUpdateRequest {
  string sessionId = 1; // id сессии
  string displayName = 2; // Имя для отображения
  google.protobuf.Timestamp birthday = 3; // дата для рождения
  string gender = 4; // пол
  string searchGender = 5; // поиск по половому признаку
  string location = 6; // местоположение
  string description = 7; // описание
  double height = 8; // рост
  double weight = 9; // вес
  string lookingFor = 10; // цель поиска
  uint64 telegramUserId = 11; // id пользователя в телеграм
  string telegramUsername = 12; // username пользователя в телеграм
  string telegramFirstName = 13; // имя пользователя в телеграм
  string telegramLastName = 14; // фамилия пользователя в телеграм
  string telegramLanguageCode = 15; // язык пользователя в телеграм
  bool telegramAllowsWriteToPm = 16; // true, если этот пользователь разрешил боту отправлять ему сообщения
  string telegramQueryId = 17; // id чата в телеграм
  optional double latitude = 18; // широта
  optional double longitude = 19; // долгота
  uint64 ageFrom = 20; // возраст от
  uint64 ageTo = 21; // возраст до
  double distance = 22; // дистанция
  uint64 page = 23; // номер текущей страницы
  uint64 size = 24; // количество элементов на странице
  bool isImages = 25;
  repeated FileMetadata files = 26;
}

message ProfileDeleteRequest {
  string sessionId = 1; // id сессии
}

message ProfileDeleteResponse {
  bool success = 1; // успешно удалено да/нет
}

message ProfileRestoreRequest {
  string sessionId = 1; // id сессии
}

message ProfileRestoreResponse {
  bool success = 1; // успешно удалено да/нет
}

message ProfileGetBySessionIdRequest {
  string sessionId = 1; // id сессии
  optional double latitude = 2; // широта
  optional double longitude = 3; // долгота
}

message ProfileBySessionIdResponse {
  string sessionId = 1; // id сессии
  string displayName = 2; // Имя для отображения
  google.protobuf.Timestamp birthday = 3; // дата для рождения
  string gender = 4; // пол
  string location = 5; // местоположение
  string description = 6; // описание
  double height = 7; // рост
  double weight = 8; // вес
  bool isDeleted = 9; // удален пользователь да/нет
  bool isBlocked = 10; // заблокирован пользователь да/нет
  bool isPremium = 11; // наличие премиум аакаунта да/нет
  bool isShowDistance = 12; // показывать дистанцию до текущего пользваотеля да/нет
  bool isInvisible = 13; // неведимка да/нет
  bool isOnline = 14; // пользователь онлайн да/нет
  google.protobuf.Timestamp createdAt = 15; // дата создания
  google.protobuf.Timestamp updatedAt = 16; // дата обновления
  google.protobuf.Timestamp lastOnline = 17; // дата последнего входа в систему
  NavigatorResponse navigator = 18; // объект навигатор
  FilterResponse filter = 19; // объект фильтр
  TelegramResponse telegram = 20; // объект телеграм
  repeated Image images = 21; // список изображений
}

message ProfileGetDetailRequest {
  string sessionId = 1; // id сессии
  string viewedSessionId = 2; // id сессии того, кого смотрим
  optional double latitude = 3; // широта
  optional double longitude = 4; // долгота
}

message ProfileDetailResponse {
  string sessionId = 1; // id сессии
  string displayName = 2; // Имя для отображения
  google.protobuf.Timestamp birthday = 3; // дата для рождения
  string gender = 4; // пол
  string location = 5; // местоположение
  string description = 6; // описание
  double height = 7; // рост
  double weight = 8; // вес
  bool isDeleted = 9; // удален пользователь да/нет
  bool isBlocked = 10; // заблокирован пользователь да/нет
  bool isPremium = 11; // наличие премиум аакаунта да/нет
  bool isShowDistance = 12; // показывать дистанцию до текущего пользователя да/нет
  bool isInvisible = 13; // неведимка да/нет
  bool isOnline = 14; // пользователь онлайн да/нет
  google.protobuf.Timestamp createdAt = 15; // дата создания
  google.protobuf.Timestamp updatedAt = 16; // дата обновления
  google.protobuf.Timestamp lastOnline = 17; // дата последнего входа в систему
  NavigatorDetailResponse navigator = 18; // объект навигатор
  TelegramResponse telegram = 19; // объект телеграм
  BlockResponse block = 20; // объект блок
  LikeResponse like = 21; //  объект дайк
  repeated Image images = 22; // список изображений
}

message ProfileGetShortInfoRequest {
  string sessionId = 1; // id сессии
  optional double latitude = 2; // широта
  optional double longitude = 3; // долгота
}

message ProfileShortInfoResponse {
  string sessionId = 1; // id сессии
  string imageUrl = 2; // url освного изображения
  bool isDeleted = 3; // удален пользователь да/нет
  bool isBlocked = 4; // заблокирован пользователь да/нет
}

message ProfileGetListRequest {
  string sessionId = 1; // id сессии
  optional double latitude = 2; // широта
  optional double longitude = 3; // долгота
}

message ProfileListItemResponse {
  string sessionId = 1; // id сессии
  optional double distance = 2; // дистанция
  string url = 3; // url изображения
  bool isOnline = 4; // пользователь онлайн да/нет
  google.protobuf.Timestamp lastOnline = 5; // дата последнего входа в систему
}

message ProfileListResponse {
  bool hasPrevious = 1; // наличие предыдущих страниц да/нет
  bool hasNext = 2; // наличие следующих страниц да/нет
  uint64 page = 3; // номер текущей страницы
  uint64 size = 4; // количество элементов на странице
  uint64 totalEntities = 5; // общее количество элементов
  uint64 totalPages = 6; // общее количество страниц
  repeated ProfileListItemResponse content = 7; // список профилей
}

message GetImageBySessionIdRequest {
  string sessionId = 1; // id сессии
  string fileName = 2; // название файла с расширением
}

message ImageBySessionIdResponse {
  bytes file = 1; // файл
}

message GetImageByIdRequest {
  uint64 id = 1; // id изображения
}

message ImageDeleteRequest {
  uint64 id = 1; // id файла
}

message ImageDeleteResponse {
  bool success = 1; // успешно удаление файла да/нет
}

message FilterGetRequest {
  string sessionId = 1; // id сессии
  optional double latitude = 2; // широта
  optional double longitude = 3; // долгота
}

message FilterGetResponse {
  string sessionId = 1; // id сессии
  string searchGender = 2; // поиск по половому признаку
  string lookingFor = 3; // цель поиска
  uint64 ageFrom = 4; // возраст от
  uint64 ageTo = 5; // возраст до
  double distance = 6; // дистанция
  uint64 page = 7; // номер текущей страницы
  uint64 size = 8; // количество элементов на странице
}

message FilterUpdateRequest {
  string sessionId = 1; // id сессии
  string searchGender = 2; // поиск по половому признаку
  uint64 ageFrom = 3; // возраст от
  uint64 ageTo = 4; // возраст до
}

message FilterUpdateResponse {
  string sessionId = 1; // id сессии
  string searchGender = 2; // поиск по половому признаку
  string lookingFor = 3; // цель поиска
  uint64 ageFrom = 4; // возраст от
  uint64 ageTo = 5; // возраст до
  double distance = 6; // дистанция
  uint64 page = 7; // номер текущей страницы
  uint64 size = 8; // количество элементов на странице
}

message BlockAddRequest {
  string sessionId = 1; // id сессии
  string blockedUserSessionId = 2; // id сессии того, кого блокируем
}

message BlockAddResponse {
  uint64 id = 1; // id блока
  string sessionId = 2; // id сессии
  string blockedUserSessionId = 3; // id сессии того, кого заблокировали
  bool isBlocked = 4; // заблокирован пользователь да/нет
  google.protobuf.Timestamp createdAt = 5; // дата создания
  google.protobuf.Timestamp updatedAt = 6; // дата обновления
}

message LikeAddRequest {
  string sessionId = 1; // id сессии
  string likedSessionId = 2; // id сессии того, кто понравился
  string locale = 3; // локаль пользователя
}

message LikeAddResponse {
  uint64 id = 1; // id блока
  string sessionId = 2; // id сессии
  string likedSessionId = 3; // id сессии того, кто понравился
  bool isLiked = 4; // есть лайк да/нет
  google.protobuf.Timestamp createdAt = 5; // дата создания
  google.protobuf.Timestamp updatedAt = 6; // дата обновления
}

message LikeUpdateRequest {
  uint64 id = 1; // id блока
  string sessionId = 2; // id сессии
  bool isLiked = 3; // есть лайк да/нет
}

message LikeUpdateResponse {
  uint64 id = 1; // id блока
  string sessionId = 2; // id сессии
  string likedSessionId = 3; // id сессии того, кто понравился
  bool isLiked = 4; // есть лайк да/нет
  google.protobuf.Timestamp createdAt = 5; // дата создания
  google.protobuf.Timestamp updatedAt = 6; // дата обновления
}

message ComplaintAddRequest {
  string sessionId = 1; // id сессии
  string criminalSessionId = 2; // id сессии мошенника
  string reason = 3; // причина жалобы
}

message ComplaintAddResponse {
  uint64 id = 1; // id блока
  string sessionId = 2; // id сессии
  string criminalSessionId = 3; // id сессии мошенника
  string reason = 4; // причина жалобы
  google.protobuf.Timestamp createdAt = 5; // дата создания
  google.protobuf.Timestamp updatedAt = 6; // дата обновления
}

message NavigatorUpdateRequest {
  string sessionId = 1; // id сессии
  double latitude = 2; // широта
  double longitude = 3; // долгота
}

message NavigatorUpdateResponse {
  string sessionId = 1; // id сессии
  Point location = 2; // объект с координатами
}

/*
* Описание сервиса Profile
*/
service Profile {
  rpc AddProfile(ProfileAddRequest) returns (ProfileAddResponse); // добавление нового пользователя
  rpc UpdateProfile(ProfileUpdateRequest) returns (ProfileBySessionIdResponse); // обновление данных пользователя
  rpc DeleteProfile(ProfileDeleteRequest) returns (ProfileDeleteResponse); // удаление пользователя
  rpc RestoreProfile(ProfileRestoreRequest) returns (ProfileRestoreResponse); // восстановление пользователя
  rpc GetProfileBySessionId(ProfileGetBySessionIdRequest) returns (ProfileBySessionIdResponse); // получение профиля по id сессии
  rpc GetProfileDetail(ProfileGetDetailRequest) returns (ProfileDetailResponse); // получение карточки профиля
  rpc GetProfileShortInfo(ProfileGetShortInfoRequest) returns (ProfileShortInfoResponse); // получение короткой информации по профилю
  rpc GetProfileList(ProfileGetListRequest) returns (ProfileListResponse); // получение списка профилей
  rpc GetImageBySessionId(GetImageBySessionIdRequest) returns (ImageBySessionIdResponse); // получение файла
  rpc GetImageById(GetImageByIdRequest) returns (Image); // получение изображения по id
  rpc DeleteImage(ImageDeleteRequest) returns (ImageDeleteResponse); // удаление файла
  rpc GetFilterBySessionId(FilterGetRequest) returns (FilterGetResponse); // получение данных фильтра
  rpc UpdateFilter(FilterUpdateRequest) returns (FilterUpdateResponse); // получение данных фильтра
  rpc AddBlock(BlockAddRequest) returns (BlockAddResponse); // добавить пользователя в блок лист
  rpc AddLike(LikeAddRequest) returns (LikeAddResponse); // поставить лайк
  rpc UpdateLike(LikeUpdateRequest) returns (LikeUpdateResponse); // обновить лайк
  rpc AddComplaint(ComplaintAddRequest) returns (ComplaintAddResponse); // добавить жалобу
  rpc UpdateCoordinates(NavigatorUpdateRequest) returns (NavigatorUpdateResponse); // обновление координат
}